FROM maven:3.9.6-eclipse-temurin-21 AS build
WORKDIR /app
  
  # Copia arquivos do Maven
COPY pom.xml .
COPY mvnw .
COPY .mvn .mvn
  
  # Copia o código fonte
COPY src ./src
  
  # Faz o build da aplicação
RUN mvn clean package -DskipTests -Pproduction
  
  # Estágio final - apenas JRE
FROM eclipse-temurin:21-jre-jammy
WORKDIR /app
  
  # Copia o JAR gerado
COPY --from=build /app/target/*.jar app.jar
  
  # Expõe a porta
EXPOSE 8080
  
  # Executa a aplicação
ENTRYPOINT ["java", "-jar", "app.jar"]
```